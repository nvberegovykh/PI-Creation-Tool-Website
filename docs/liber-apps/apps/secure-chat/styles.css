html,body{height:100%;margin:0;overflow:hidden;-webkit-text-size-adjust:100%;text-size-adjust:100%}
.chat-app{display:flex;flex-direction:column;position:fixed;top:0;left:0;right:0;bottom:0;width:100vw;max-width:100vw;height:100vh;height:100svh;height:100dvh;overflow:hidden;background:var(--primary-bg,#000);color:var(--primary-text,#eaeaea);font-family:var(--app-font,"Montserrat","Segoe UI",Roboto,Arial,sans-serif);touch-action:manipulation;overscroll-behavior:none;padding-top:env(safe-area-inset-top);box-sizing:border-box}
.sidebar{position:absolute;z-index:20;display:flex;flex-direction:column;background:#0f1116;transition:transform .25s ease, max-height .25s ease, height .25s ease}
/* Desktop: inline sidebar + chat */
@media(min-width:769px){
  .chat-app{flex-direction:row}
  .sidebar{position:relative;top:auto;bottom:auto;left:auto;width:320px;min-width:260px;border-right:1px solid var(--border-color,#1f222a);height:100%;transform:none;box-shadow:none;z-index:auto}
  .connections-panel{position:static;display:flex;flex-direction:column;min-height:0;height:100%}
}
/* Mobile: top bar dropdown */
@media(max-width:768px){
  .chat-app{--mobile-bar-height:56px;--mobile-search-height:56px}
  .sidebar{position:relative;top:auto;left:auto;right:auto;bottom:auto;width:100%;min-width:unset;border-right:none;border-bottom:1px solid var(--border-color,#1f222a);height:var(--mobile-bar-height);transform:none;box-shadow:none;z-index:5}
  .sidebar-header{height:var(--mobile-bar-height);padding:0 12px;display:flex;align-items:center}
  .connections-panel{position:absolute;top:calc(var(--mobile-bar-height) + 24px);left:10px;right:10px;background:#0f1116;border:1px solid var(--border-color,#1f222a);border-radius:10px;box-shadow:0 12px 24px rgba(0,0,0,.35);height:0;overflow:hidden;transition:height .25s ease;z-index:21;display:block;pointer-events:none}
  .sidebar.open .connections-panel{height:50vh;height:50svh;overflow:auto;pointer-events:auto}
  .mobile-sidebar-tip{display:flex}
  /* ensure header tap works in webview */
  #sidebar-header *{pointer-events:auto}
  .sidebar:not(.open) .connections-panel .connections-list{display:none}
  .main{padding-top:var(--mobile-bar-height)}
  .chat-app:not(.mobile-menu-open) .chat-header .header-actions{display:none}
}
.sidebar-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border-color,#1f222a);cursor:pointer}
.sidebar-header .left-actions{display:flex;align-items:center;gap:10px}
.sidebar-header .header-actions{display:flex;align-items:center;gap:8px}
.mobile-quick-actions{display:none !important}
.icon-btn{background:transparent;border:none;color:#eaeaea;cursor:pointer;font-size:18px;line-height:1;padding:8px;border-radius:8px}
.icon-btn:hover{background:#151822}
.icon-btn i{color:#fff;font-size:18px}
.icon-btn, .btn, .composer textarea, .search-box input{ -webkit-user-select:none; user-select:none }
.messages .message{ -webkit-user-select:text; user-select:text }
.sidebar.collapsed .search-box, .sidebar.collapsed #connections-list{display:none}
.sidebar-header h2{font-size:14px;letter-spacing:.5px;text-transform:uppercase;color:#9aa4b2;margin:0;display:flex;align-items:center;gap:6px}
.nav-badge{display:inline-flex;align-items:center;justify-content:center;min-width:18px;height:18px;padding:0 5px;font-size:11px;font-weight:600;background:#2563eb;color:#fff;border-radius:999px}
.nav-badge.hidden{display:none !important}
.icon-btn.has-badge{position:relative}
.icon-btn.has-badge .nav-badge{position:absolute;top:-4px;right:-4px;min-width:16px;height:16px;font-size:10px}
.search-box{padding:10px 12px}
.search-box input{width:100%;padding:10px 12px;border:1px solid var(--border-color,#1f222a);border-radius:10px;background:#14161b;color:#eaeaea;outline:none;font-size:16px}
.connections-panel{display:flex;flex-direction:column;min-height:0;height:100%}
.connections-list{list-style:none;margin:0;padding:8px 0;overflow:auto;-webkit-overflow-scrolling:touch;flex:1;overscroll-behavior:contain;max-height:100%}
.connections-list::-webkit-scrollbar{width:0;height:0}
/* Group builder */
.group-builder{padding:8px 12px;border-top:1px solid #1f222a;display:flex;align-items:center;gap:8px}
.chips{display:flex;flex-wrap:wrap;gap:6px}
.chip{background:#14161b;color:#eaeaea;border:1px solid #1f222a;border-radius:12px;padding:6px 10px;font-size:12px;cursor:pointer}
@media(max-width:768px){
  .connections-panel .search-box{position:sticky;top:0;background:#0f1116;z-index:1;padding-bottom:6px;margin-bottom:4px}
  .connections-panel .connections-list{max-height:unset}
}
.connections-list li{padding:12px 16px;border-bottom:1px solid var(--border-color,#1f222a);cursor:pointer;transition:background .2s ease, opacity .2s ease}
.connections-list li{animation:conn-item-in .25s ease-out}
@keyframes conn-item-in{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
.connections-list.loading li{animation:none}
.connections-list li:hover{background:#161922}
.connections-list li.active{background:#14161b}
.main{flex:1;display:flex;flex-direction:column;background:#000;min-height:0}
.chat-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border-color,#1f222a);position:sticky;top:0;background:inherit;z-index:1}
.header-actions{display:flex;gap:8px;align-items:center}
.chat-header h3{font-size:16px;font-weight:600}
.voice-top-strip{display:flex;align-items:center;gap:8px;height:32px;padding:1px 8px;border-bottom:1px solid var(--border-color,#1f222a);background:#0b111a}
.voice-top-strip.hidden{display:none}
.voice-top-strip .icon-btn{padding:4px 8px}
.voice-top-title{flex:1;min-width:0;font-size:12px;color:#dbe2ef;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.voice-top-main{flex:1;min-width:0;display:flex;flex-direction:column;gap:2px}
.voice-top-progress{display:flex;align-items:center;gap:8px;min-width:0}
.voice-top-wave{flex:1;min-width:0;display:flex;gap:2px;align-items:flex-end;height:12px;overflow:hidden}
.voice-top-wave .bar{width:2px;border-radius:2px;background:#556076;opacity:.95;transition:background-color .08s linear}
.voice-top-wave .bar.played{background:#ffffff}
.voice-top-time{font-size:10px;color:#9da8bc;white-space:nowrap;min-width:58px;text-align:right}
.typing-indicator{
  min-height: 0;
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  padding: 0 12px;
  font-size: 12px;
  color: #95a3b8;
  transform: translateY(-3px);
  transition: max-height .22s ease, opacity .2s ease, transform .2s ease, padding .2s ease;
}
.typing-indicator.show{
  max-height: 26px;
  min-height: 20px;
  opacity: 1;
  padding: 4px 12px 2px;
  transform: translateY(0);
}
.dialogue-title-bar{position:sticky;bottom:0;left:0;right:0;height:5px;background:#000;color:#fff;display:flex;align-items:center;padding:0 12px}
.dialogue-title-bar .title{position:relative;top:-22px;font-size:12px;background:#000;padding:2px 6px;border-radius:4px}
.dialogue-title-bar .title #admin-badge{color:#9aa4b2}
.call-overlay{position:fixed;inset:0;width:100vw;height:100vh;max-width:100vw;max-height:100vh;overflow:hidden;background:rgba(0,0,0,.88);display:grid;grid-template-rows:auto 1fr auto auto;align-items:stretch;justify-items:center;z-index:100;animation:call-fade-in .25s ease-out;padding:8px 8px 10px}
.call-overlay.hidden{display:none}
@keyframes call-fade-in{from{opacity:0}to{opacity:1}}
.call-videos{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,300px));grid-auto-rows:minmax(140px,300px);gap:8px;align-content:center;justify-content:center;justify-items:center;padding:6px;width:min(100%,1200px);height:100%;max-height:100%;overflow:auto}
.call-tile{position:relative;background:#0d1017;border:1px solid rgba(255,255,255,.12);border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;width:100%;height:100%;max-height:300px;min-height:140px;aspect-ratio:1 / 1;opacity:1;transform:translateY(0);transition:opacity .22s ease,transform .22s ease,box-shadow .22s ease}
.call-tile video{background:#111;width:100%;height:100%;object-fit:cover;object-position:center center;box-shadow:none;transition:opacity .2s;cursor:pointer}
.call-tile.screen{grid-column:span 2;aspect-ratio:16 / 9}
.call-tile.screen video{object-fit:contain;background:#000}
.call-tile.call-tile-enter{opacity:0;transform:translateY(6px) scale(.985)}
.call-tile-expand{position:absolute;right:6px;top:6px;z-index:2;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.18);color:#fff;border-radius:8px;width:26px;height:26px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer}
.call-videos video.connecting{opacity:.6}
.call-controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;justify-content:center}
#call-overlay .call-controls .btn{background:transparent !important;border:0 !important;box-shadow:none !important;color:#e5e7eb;padding:8px;min-width:38px;min-height:38px}
.call-controls .btn:hover{color:#fff;transform:translateY(-1px)}
.call-controls .btn.muted{opacity:.5}
.call-controls .btn.active{color:#60a5fa}
.call-controls .btn[disabled]{opacity:.35;cursor:not-allowed;pointer-events:auto}
.call-controls .btn[disabled]:hover{transform:none;color:#e5e7eb}
.call-participants{ display:flex; gap:6px; margin-top:6px; padding:2px 4px 0; box-sizing:border-box; flex-wrap:nowrap; align-items:center; justify-content:center; width:min(100%,560px); max-width:calc(100vw - 16px); min-height:48px; max-height:76px; overflow-x:auto; overflow-y:hidden }
.call-participants .avatar{ position:relative; width:44px; height:44px; border-radius:50%; background:#111; overflow:hidden; box-shadow:0 0 0 2px #9ca3af inset; transition:box-shadow .2s }
.call-participants .avatar.connected{ box-shadow:0 0 0 2px #22c55e inset }
.call-participants .avatar.connecting{ box-shadow:0 0 0 2px #f59e0b inset; animation:pulse-connecting 1.5s ease-in-out infinite }
.call-participants .avatar.speaking{ box-shadow:0 0 0 2px #22c55e inset, 0 0 0 4px #2563eb }
@keyframes pulse-connecting{ 50%{ opacity:.7 } }
.call-participants .avatar img{ width:100%; height:100%; object-fit:cover; border-radius:50%; display:block }
/* Hide labels below avatars */
.call-participants .avatar .name, .call-participants .avatar .state{ display:none !important }
.call-fullscreen{position:fixed;inset:0;z-index:130;background:rgba(0,0,0,.94)}
.call-fullscreen.hidden{display:none}
.call-fullscreen-media{position:absolute;inset:0;display:flex;align-items:center;justify-content:center}
.call-fullscreen-media .call-tile{width:100%;height:100%;max-width:none;max-height:none;border:0;border-radius:0;aspect-ratio:auto}
.call-fullscreen-media .call-tile video{width:100%;height:100%;object-fit:contain;object-position:center center}
.call-draw-canvas{position:absolute;inset:0;width:100%;height:100%;touch-action:none;pointer-events:auto}
.call-draw-tools{position:absolute;top:12px;right:12px;display:flex;align-items:center;gap:8px;background:rgba(6,8,12,.5);border:1px solid rgba(255,255,255,.16);border-radius:999px;padding:6px 10px}
.call-draw-tools .btn{background:transparent !important;border:0 !important;color:#fff;padding:6px}
.draw-palette{display:flex;gap:6px;padding:4px 6px;border-radius:999px;background:rgba(9,12,18,.84);border:1px solid rgba(255,255,255,.14)}
.draw-palette.hidden{display:none}
.draw-color{width:16px;height:16px;border-radius:50%;border:1px solid rgba(255,255,255,.55);background:var(--c,#fff);padding:0;cursor:pointer}
#draw-size{width:96px}
@media (max-width: 760px){
  .call-videos{grid-template-columns:repeat(2,minmax(132px,1fr));align-content:start}
  .call-tile.screen{grid-column:span 2}
  .call-overlay{padding-bottom:calc(10px + env(safe-area-inset-bottom))}
  .call-participants{width:100%;max-width:calc(100vw - 12px);justify-content:flex-start}
}
.call-fab{
  position: fixed;
  right: 14px;
  bottom: 82px;
  z-index: 90;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 44px;
  min-height: 44px;
  padding: 0;
  cursor: grab;
}
.call-fab.dragging{ cursor: grabbing; }
.messages{flex:1;overflow:auto;padding:20px;display:flex;flex-direction:column-reverse;gap:10px;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;overflow-anchor:none;scroll-behavior:auto}
.messages::-webkit-scrollbar{width:0;height:0}
.message{max-width:72%;padding:12px 14px;border-radius:14px;line-height:1.4;box-shadow:0 4px 18px rgba(0,0,0,.25);word-break:break-word;overflow-wrap:anywhere;contain:layout;animation:msg-fade-in .28s ease-out}
@keyframes msg-fade-in{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.message,.connections-list li{word-break:break-word;overflow-wrap:anywhere}
.message img,.message .file-link{max-width:100%}
.message.self{align-self:flex-end;background:#2563eb;color:#fff;border-bottom-right-radius:4px}
.message.other{align-self:flex-start;background:#151823;border-bottom-left-radius:4px}
.message.message-media-only{
  background: transparent !important;
  box-shadow: none !important;
  padding: 4px 0 !important;
}
.message .meta{font-size:12px;opacity:.7;margin-top:6px}
.message-system{
  align-self: center !important;
  max-width: min(92%, 560px);
  background: rgba(76, 92, 120, .16) !important;
  border: 1px solid rgba(124, 135, 152, .35);
  color: #d7deea;
  border-bottom-left-radius: 14px !important;
  border-bottom-right-radius: 14px !important;
  box-shadow: 0 2px 10px rgba(0,0,0,.2);
}
.message-connection-request .msg-text{
  text-align: center;
}
.message-call-badge{
  max-width: min(92%, 420px) !important;
  padding: 8px 10px !important;
}
.message-call-badge .meta{
  display: none !important;
}
.message-call-badge .msg-text{
  text-align: center;
}
.call-msg-wrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
}
.call-status-badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  min-height:28px;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid rgba(37,99,235,.55);
  background:#2563eb;
  color:#fff;
  font-size:12px;
  font-weight:600;
}
button.call-status-badge{
  cursor:pointer;
}
button.call-status-badge:hover{
  filter:brightness(1.06);
}
.call-status-badge.ended{
  border-color:rgba(124,135,152,.45);
  background:rgba(76,92,120,.28);
  color:#e5e7eb;
}
.call-status-time{
  font-size:10px;
  color:#9fb0c7;
  line-height:1.2;
}
.voice-wave-player .time{font-family: var(--typewriter-font,"Courier Prime","Courier New","Lucida Console",monospace);}
.chat-app input::placeholder,
.chat-app textarea::placeholder{
  font-family: var(--typewriter-font,"Courier Prime","Courier New","Lucida Console",monospace);
}
.message .meta .system-chip{
  display: inline-block;
  margin-right: 6px;
  padding: 1px 7px;
  border-radius: 999px;
  border: 1px solid rgba(124, 135, 152, .45);
  color: #aab4c3;
  font-size: 11px;
  line-height: 1.3;
}
.message .meta .msg-edited-badge,
.message .meta .msg-delivery{
  display:inline-block;
  padding:1px 6px;
  border-radius:999px;
  border:1px solid rgba(124,135,152,.32);
  color:#b9c3d3;
  font-size:10px;
  line-height:1.3;
}
.message .meta .msg-repost-badge{
  display:inline-block;
  padding:1px 6px;
  border-radius:999px;
  border:1px solid rgba(91,179,255,.45);
  color:#d5ebff;
  font-size:10px;
  line-height:1.3;
  background:rgba(44,107,199,.18);
}
.message .meta .msg-original-author{
  color:#a9c6e6;
  font-size:11px;
}
.composer{display:flex;gap:10px;padding:10px 12px;border-top:1px solid var(--border-color,#1f222a);background:#0f1116;align-items:flex-end}
.composer textarea{flex:1;resize:none;padding:12px 14px;border:1px solid var(--border-color,#1f222a);border-radius:14px;background:#14161b;color:#eaeaea;outline:none;max-height:160px;min-height:44px;font-size:16px}
.chat-app input,.chat-app textarea{font-size:16px}
.btn{background:#2563eb;border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;transition:transform .05s ease,opacity .2s ease}
.btn:active{transform:translateY(1px)}
.btn.secondary{background:#222737}
.btn.back{display:none}
/* Sticker panel */
.sticker-panel{position:absolute;bottom:80px;left:70px;width:320px;max-height:260px;overflow:auto;background:#111418;border:1px solid #2a2f36;border-radius:10px;padding:8px;box-shadow:0 10px 24px rgba(0,0,0,.4);z-index:92}
.sticker-backdrop{position:fixed;inset:0;background:transparent;z-index:91}
.sticker-panel .panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.sticker-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.sticker-panel .sticker-grid:first-child{margin-bottom:6px;border-bottom:1px dashed #2a2f36;padding-bottom:6px}
.sticker-grid img{width:70px;height:70px;object-fit:contain;background:#0f1216;border:1px solid #2a2f36;border-radius:8px;cursor:pointer}
.sticker-pack-actions{display:flex;gap:6px}
.sticker-pack-list{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:8px}
.sticker-pack-chip{border:1px solid #2a2f36;border-radius:8px;background:#0f1216;padding:4px;display:flex;align-items:center;justify-content:center;cursor:pointer;height:56px}
.sticker-pack-chip.active{border-color:#2563eb}
.sticker-top-tabs{display:flex;gap:6px;margin-bottom:8px}
.sticker-top-tabs .tab{background:#1a1e27;color:#c9cfdb;border:none;border-radius:8px;padding:6px 10px;font-size:12px;cursor:pointer}
.sticker-top-tabs .tab.active{background:#2563eb;color:#fff}
.sticker-pack-manage{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.sticker-pack-manage .icon-btn{width:28px;height:28px;border-radius:999px;background:#1a1e27;display:flex;align-items:center;justify-content:center}
.sticker-pack-manage .icon-btn.add{background:#2563eb}
.new-messages-separator{
  align-self:center;
  color:#d5e6ff;
  font-size:11px;
  margin:10px 0 4px 0;
  padding:2px 10px;
  border:1px solid rgba(77,163,255,.45);
  border-radius:999px;
  background:rgba(43,108,196,.24);
}
.composer-attachments{
  border-top:1px solid var(--border-color,#1f222a);
  background:#0f1116;
  padding:8px 12px 6px;
}
.composer-attachments.hidden{
  display:none;
}
.composer-attachments-slider{
  display:flex;
  gap:8px;
  overflow-x:auto;
  overflow-y:hidden;
  padding-bottom:2px;
}
.composer-attachments-slider::-webkit-scrollbar{
  height:0;
  width:0;
}
.composer-attachment-card{
  flex:0 0 190px;
  min-width:190px;
  max-width:220px;
  display:flex;
  align-items:center;
  gap:8px;
  background:#141a25;
  border:1px solid #273247;
  border-radius:10px;
  padding:7px 8px;
}
.composer-attachment-thumb{
  width:34px;
  height:34px;
  border-radius:7px;
  object-fit:cover;
  border:1px solid rgba(255,255,255,.12);
  flex:0 0 auto;
}
.composer-attachment-icon{
  width:34px;
  height:34px;
  border-radius:7px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background:#223149;
  color:#d7e6ff;
  border:1px solid rgba(255,255,255,.1);
  flex:0 0 auto;
}
.composer-attachment-meta{
  min-width:0;
  flex:1;
}
.composer-attachment-name{
  font-size:12px;
  color:#dbe7ff;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.composer-attachment-size{
  font-size:11px;
  color:#9cb0cf;
}
.composer-attachment-remove{
  border:none;
  background:transparent;
  color:#b7c5db;
  width:22px;
  height:22px;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  flex:0 0 auto;
}
.composer-attachment-remove:hover{
  background:rgba(255,255,255,.08);
}
.msg-load-more-wrap{display:flex;justify-content:center;margin:6px 0 10px;padding:4px 0;opacity:1}
.msg-load-more-btn{transition:opacity .2s ease,transform .05s ease;min-width:140px}
.msg-load-more-btn:disabled{opacity:.7;cursor:not-allowed}
.msg-load-more-btn.loading{pointer-events:none}
.msg-load-more-btn.loading::after{content:'';display:inline-block;width:14px;height:14px;margin-left:8px;border:2px solid currentColor;border-top-color:transparent;border-radius:50%;animation:msg-spin .6s linear infinite;vertical-align:middle}
@keyframes msg-spin{to{transform:rotate(360deg)}}
.message-day-separator{align-self:center;text-align:center;font-size:11px;color:#8b95a6;margin:10px 0 4px 0;padding:8px 10px;opacity:.9;animation:day-sep-in .22s ease-out}
@keyframes day-sep-in{from{opacity:0;transform:translateY(-3px)}to{opacity:.9;transform:translateY(0)}}
.new-messages-separator{align-self:center;font-size:11px;color:#6b9eff;padding:6px 12px;background:rgba(37,99,235,.12);border-radius:999px;margin:8px 0;animation:day-sep-in .22s ease-out}
.message .msg-text:empty{display:none}
.file-preview img{cursor:pointer}
.file-preview audio{width:100%;background:#131a27;border-radius:14px;padding:4px}
.file-preview img,.file-preview video{max-width:min(100%,360px);max-height:360px;object-fit:contain}
.file-preview video.video-recording-mask{
  width:min(64vw,220px);
  height:min(64vw,220px);
  max-width:220px;
  max-height:220px;
  object-fit:cover;
  display:block;
}
.audio-attachment-block{
  display:flex;
  flex-direction:column;
  gap:8px;
  background:#0f1724;
  border:1px solid #273247;
  border-radius:12px;
  padding:8px 10px;
}
.audio-attachment-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}
.audio-attachment-meta{
  font-size:12px;
  opacity:.9;
  word-break:break-word;
  font-family: var(--typewriter-font,"Courier Prime","Courier New","Lucida Console",monospace);
}
.audio-attachment-head .btn{
  min-width:28px;
  width:28px;
  height:28px;
  padding:0;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
.voice-wave-player{
  display:flex;
  align-items:center;
  gap:8px;
  background:#0f1724;
  border:1px solid #273247;
  border-radius:14px;
  padding:6px 10px;
  margin-top:6px;
  width:fit-content;
  max-width:100%;
  min-width:160px;
  box-sizing:border-box;
  overflow:hidden;
}
.voice-wave-player .play{width:28px;height:28px;border-radius:999px;border:none;background:#1b2a43;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}
.voice-wave-player .wave{
  flex:1;
  min-width:0;
  max-width:100%;
  display:flex;
  gap:2px;
  align-items:flex-end;
  height:22px;
  cursor:pointer;
  touch-action:none;
  overflow:hidden;
}
.voice-wave-player .wave .bar{width:2px;border-radius:2px;background:#6e798b;opacity:.95;transition:background-color .08s linear}
.voice-wave-player .wave .bar.played{background:#ffffff}
.voice-wave-player .time{font-size:11px;color:#9da8bc;min-width:52px;max-width:72px;flex:0 0 auto;text-align:right;cursor:pointer;white-space:nowrap}
/* Slider in chat: fit media bounds like WhatsApp */
.message .msg-media-slider,
.message .post-media-visual-shell.msg-media-slider{width:fit-content;max-width:100%;min-width:min(140px,100%)}
.message .msg-media-slider .post-media-visual-wrap,
.message .post-media-visual-shell.msg-media-slider .post-media-visual-wrap{max-width:min(72vw,300px);overflow-x:auto}
.message .msg-media-slider .post-media-visual-item,
.message .msg-media-slider .msg-media-item{max-width:min(72vw,300px)}
.message .msg-media-slider .msg-slider-preview img,
.message .msg-media-slider .msg-slider-preview video,
.message .msg-media-slider .file-preview img,
.message .msg-media-slider .file-preview video{max-width:100%;max-height:240px;object-fit:contain;border-radius:8px;display:block}
/* Recording indicator */
.recording-indicator{ position:absolute; left:50%; transform:translateX(-50%); bottom:62px; z-index:30 }
.recording-indicator .record-dot{ width:56px; height:56px; border-radius:50%; background:#2563eb; display:flex; align-items:center; justify-content:center; box-shadow:0 10px 30px rgba(37,99,235,.5) }
.recording-indicator .record-dot i{ color:#fff; font-size:20px }
.recording-indicator.hidden{ display:none }
.recording-review{
  position: relative;
  left: auto;
  right: auto;
  bottom: auto;
  grid-column: 1 / -1;
  width: 100%;
  background: transparent;
  border-top: 1px solid var(--border-color,#1f222a);
  padding: 8px 6px 4px;
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}
.recording-review.hidden{ display:none }
.recording-review audio,.recording-review video{ max-width:100%; width:100%; border-radius:8px; background:#000 }
.recording-review video.video-recording-mask{ width:min(64vw,220px); height:min(64vw,220px); max-width:220px; max-height:220px; object-fit:cover; display:block }
.review-actions{ display:flex; gap:8px; margin-left:auto }
.review-actions #send-recording-btn{ display:inline-flex !important; }
#recording-player{ flex:1; min-width: 0; }
/* Group management */
.group-panel{position:absolute;top:68px;right:16px;width:320px;max-height:320px;overflow:auto;background:#111418;border:1px solid #2a2f36;border-radius:10px;padding:10px;box-shadow:0 10px 24px rgba(0,0,0,.4);z-index:92}
.group-panel h4{margin:0 0 8px 0}
.group-list{list-style:none;margin:0;padding:0}
.group-list li{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px solid #1f222a}
.group-list li:last-child{border-bottom:none}
.group-actions{display:flex;gap:6px}
@media(max-width:1024px){.sidebar{width:min(92vw,380px)}}
@media(min-width:769px){
  .message{max-width:56%}
}
@media(max-width:768px){
  .chat-app{flex-direction:column}
  .sidebar{width:100%;min-width:unset;border-right:none;border-bottom:1px solid var(--border-color,#1f222a)}
  .main{flex:1;min-height:0}
  .messages{padding:10px 8px}
  .message{max-width:92%}
  .dialogue-title-bar{display:none}
  .chat-header{padding:8px 10px}
  .chat-header h3{font-size:14px}
  .voice-top-strip{display:flex;height:28px;padding:0 6px}
  .voice-top-title{font-size:11px}
  .typing-indicator.show{
    max-height: 22px;
    min-height: 16px;
    padding: 2px 10px;
    font-size: 11px;
  }
  .composer{
    border-top:none;
    background:transparent;
    padding:8px;
    margin:0;
  }
  .composer{
    display:grid;
    grid-template-columns:auto auto 1fr auto;
    align-items:center;
    gap:6px;
    border:1px solid var(--border-color,#1f222a);
    border-radius:18px;
    margin:8px;
    background:#0f1116;
  }
  .composer textarea{
    border:none;
    background:transparent;
    min-height:42px;
    padding:10px 8px;
    border-radius:12px;
  }
  .composer #action-btn{
    width:40px;
    height:40px;
    border-radius:10px;
    background:#007bff;
    display:flex;
    align-items:center;
    justify-content:center;
    margin-right:2px;
  }
  .sticker-backdrop{
    z-index: 98;
  }
  .sticker-panel{
    position: fixed !important;
    left: 8px !important;
    right: 8px !important;
    bottom: calc(146px + env(safe-area-inset-bottom)) !important;
    width: auto !important;
    max-width: none !important;
    max-height: min(56vh, 420px) !important;
    z-index: 110 !important;
  }
}

/* Search results grouping */
.search-results{max-height:50vh;overflow:auto}
.results-separator{position:sticky;top:0;background:#0f1116;color:#9aa4b2;font-size:12px;text-transform:uppercase;padding:6px 12px;border-top:1px solid #1f222a;border-bottom:1px solid #1f222a}
.results-group ul{list-style:none;margin:0;padding:0}
/* Prevent iOS zoom and unintended focus jump on search in header */
.chat-header input{font-size:16px}

.mobile-sidebar-tip{display:none;width:100%;height:24px;border:none;background:transparent;color:#8b97a8;align-items:center;justify-content:center;gap:8px;cursor:pointer;transition:transform .2s ease}
.mobile-sidebar-tip i{transition:transform .2s ease;transform:rotate(180deg)}
.sidebar.open .mobile-sidebar-tip i{transform:rotate(0deg)}
@keyframes msgPop{
  from{transform:translateY(3px);opacity:.5}
  to{transform:translateY(0);opacity:1}
}

/* Mobile layout hard overrides (kept last to beat earlier duplicates) */
@media (max-width: 768px){
  /* Move connections bar to bottom under composer */
  .chat-app{
    --mobile-bar-height: 44px;
  }
  .main{
    order: 1;
    padding-top: 0 !important;
  }
  .sidebar{
    order: 2;
    position: relative !important;
    left: auto !important;
    right: auto !important;
    bottom: auto !important;
    top: auto !important;
    width: 100% !important;
    min-width: 0 !important;
    height: auto !important;
    border-top: 1px solid var(--border-color,#1f222a);
    border-bottom: none !important;
    z-index: 15;
    background: #0b0f16;
    display: flex;
    flex-direction: column;
  }
  .sidebar .connections-panel{ order: 1; }
  .sidebar .mobile-sidebar-tip{ order: 2; }
  .sidebar .sidebar-header{ order: 3; }
  .sidebar-header{
    height: var(--mobile-bar-height) !important;
    min-height: var(--mobile-bar-height) !important;
    padding: 0 10px !important;
    border-bottom: none !important;
  }
  .mobile-sidebar-tip{
    display: flex;
    height: 10px;
    min-height: 10px;
    width: 100%;
    opacity: .85;
    color: #8b97a8;
    gap: 0;
    padding: 0;
  }
  .mobile-sidebar-tip span{
    display: none;
  }
  .mobile-sidebar-tip i{
    font-size: 11px;
  }
  .sidebar-header .header-actions{
    display: none !important;
  }
  .mobile-quick-actions{
    display: none;
    align-items: center;
    justify-content: flex-start;
    gap: 8px;
    padding: 8px 10px 6px;
    border-top: 1px solid var(--border-color,#1f222a);
    border-bottom: 1px solid var(--border-color,#1f222a);
  }
  .mobile-quick-actions .icon-btn{
    width: 34px;
    height: 34px;
    min-width: 34px;
    padding: 0;
    border-radius: 8px;
    background: #161e2b;
  }
  .mobile-quick-actions .btn{
    margin-left: auto;
    padding: 7px 11px;
    border-radius: 10px;
  }
  .sidebar.open .mobile-quick-actions{
    display: flex !important;
  }

  /* Keep only composer controls visible in the lower area */
  .chat-header .header-actions{
    display: none !important;
  }

  /* Stable expandable slider above the bottom bar */
  .sidebar .connections-panel{
    position: relative !important;
    top: auto !important;
    bottom: auto !important;
    left: auto !important;
    right: auto !important;
    display: flex !important;
    flex-direction: column;
    width: 100%;
    height: 0 !important;
    max-height: 0 !important;
    opacity: 0;
    overflow: hidden !important;
    pointer-events: none !important;
    transform: translateY(6px);
    transition: max-height .22s ease, opacity .22s ease, transform .22s ease, margin .22s ease !important;
    border-top: 1px solid var(--border-color,#1f222a);
    border-bottom: 1px solid var(--border-color,#1f222a);
    border-radius: 0;
    background: #0f1116;
    box-shadow: 0 -10px 20px rgba(0,0,0,.24);
    z-index: 25;
    margin: 0;
  }
  .sidebar.open .connections-panel{
    height: auto !important;
    max-height: 38vh !important;
    opacity: 1;
    overflow: hidden !important;
    pointer-events: auto !important;
    transform: translateY(0);
    margin: 0;
  }
  .sidebar.searching.open .connections-panel{
    max-height: 58vh !important;
  }
  .sidebar:not(.open) .connections-panel{
    height: 0 !important;
    max-height: 0 !important;
  }
  .connections-panel .search-box{
    position: relative;
    top: auto;
    z-index: 1;
    background: #0f1116;
  }
  .connections-panel .search-results{
    max-height: 22vh;
    overflow: auto;
  }
  .sidebar.searching.open .connections-panel .search-results{
    max-height: 34vh;
  }
  .connections-panel #connections-list{
    flex: 1;
    min-height: 120px;
    overflow: auto;
  }

  /* Cleaner message bubbles (no border-looking shadow) */
  .message{
    box-shadow: none !important;
    border: none !important;
  }
  .message-system{
    border: none !important;
    box-shadow: none !important;
  }
}


